<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多模态小说生成</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#00B42A',
                        danger: '#F53F3F',
                        dark: '#1D2129',
                        light: '#F2F3F5'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-inter bg-gray-50 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-sm fixed w-full z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-shield text-primary text-2xl"></i>
                <span class="text-dark font-bold text-xl">认证系统</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="login-nav-btn" class="text-primary hover:text-primary/80 transition-colors">登录</button>
                <button id="register-nav-btn" class="text-primary hover:text-primary/80 transition-colors">注册</button>
                <button id="logout-nav-btn" class="hidden bg-danger hover:bg-danger/90 text-white px-4 py-2 rounded-lg transition-all">
                    <i class="fa fa-sign-out mr-2"></i>退出
                </button>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="flex-grow pt-20 pb-10">
        <div class="container mx-auto px-4 flex justify-center items-center">
            <!-- 登录卡片 -->
            <div id="login-card" class="bg-white rounded-xl shadow-lg p-8 max-w-md w-full">
                <h2 class="text-2xl font-bold text-center mb-6 text-dark">用户登录</h2>
                <form id="login-form" class="space-y-5">
                    <div>
                        <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-user text-gray-400"></i>
                            </div>
                            <input type="text" id="login-username" name="username" 
                                class="pl-10 block w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/30 transition-all"
                                placeholder="请输入用户名" required>
                        </div>
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-lock text-gray-400"></i>
                            </div>
                            <input type="password" id="login-password" name="password" 
                                class="pl-10 block w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/30 transition-all"
                                placeholder="请输入密码" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-all shadow-md">
                        <i class="fa fa-sign-in mr-2"></i>登录
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    还没有账号? <button id="to-register-btn" class="text-primary hover:underline">立即注册</button>
                </p>
            </div>

            <!-- 注册卡片 -->
            <div id="register-card" class="hidden bg-white rounded-xl shadow-lg p-8 max-w-md w-full">
                <h2 class="text-2xl font-bold text-center mb-6 text-dark">创建账户</h2>
                <form id="register-form" class="space-y-5">
                    <div>
                        <label for="register-username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-user text-gray-400"></i>
                            </div>
                            <input type="text" id="register-username" name="username" 
                                class="pl-10 block w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/30 transition-all"
                                placeholder="请输入用户名" required>
                        </div>
                    </div>
                    <div>
                        <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-lock text-gray-400"></i>
                            </div>
                            <input type="password" id="register-password" name="password" 
                                class="pl-10 block w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/30 transition-all"
                                placeholder="请输入密码" required>
                        </div>
                    </div>
                    <div>
                        <label for="register-confirm-password" class="block text-sm font-medium text-gray-700 mb-1">确认密码</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-lock text-gray-400"></i>
                            </div>
                            <input type="password" id="register-confirm-password" name="confirmPassword" 
                                class="pl-10 block w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/30 transition-all"
                                placeholder="请再次输入密码" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-all shadow-md">
                        <i class="fa fa-user-plus mr-2"></i>注册
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    已有账号? <button id="to-login-btn" class="text-primary hover:underline">立即登录</button>
                </p>
            </div>

            <!-- 受保护内容卡片 -->
            <div id="protected-card" class="hidden bg-white rounded-xl shadow-lg p-8 max-w-md w-full">
                <h2 class="text-2xl font-bold text-center mb-6 text-dark">
                    <i class="fa fa-shield text-primary mr-2"></i>受保护资源
                </h2>
                <div id="protected-content" class="bg-gray-50 rounded-lg p-6 border border-gray-200 mb-6">
                    <p class="text-center text-gray-500 italic">正在加载受保护内容...</p>
                </div>
                <button id="refresh-protected-btn" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-all shadow-md">
                    <i class="fa fa-refresh mr-2"></i>刷新内容
                </button>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2023 安全认证系统 | 保护您的隐私安全</p>
        </div>
    </footer>

    <!-- 通知组件 -->
    <div id="notification" class="fixed top-20 right-4 transform translate-x-full transition-transform duration-500 z-50 max-w-sm">
        <div id="notification-content" class="bg-white rounded-lg p-4 shadow-lg border-l-4">
            <div class="flex items-start">
                <div id="notification-icon" class="flex-shrink-0 pt-0.5">
                    <i class="fa fa-info-circle text-blue-500 text-xl"></i>
                </div>
                <div class="ml-3">
                    <h3 id="notification-title" class="text-sm font-medium text-gray-800">通知标题</h3>
                    <div id="notification-message" class="mt-1 text-sm text-gray-600">
                        通知内容将显示在这里...
                    </div>
                </div>
                <button id="close-notification" class="ml-auto flex-shrink-0 text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // API配置
        const API_BASE_URL = 'http://localhost:3000/api';

        // DOM元素
        const loginCard = document.getElementById('login-card');
        const registerCard = document.getElementById('register-card');
        const protectedCard = document.getElementById('protected-card');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const toRegisterBtn = document.getElementById('to-register-btn');
        const toLoginBtn = document.getElementById('to-login-btn');
        const loginNavBtn = document.getElementById('login-nav-btn');
        const registerNavBtn = document.getElementById('register-nav-btn');
        const logoutNavBtn = document.getElementById('logout-nav-btn');
        const refreshProtectedBtn = document.getElementById('refresh-protected-btn');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notification-title');
        const notificationMessage = document.getElementById('notification-message');
        const notificationIcon = document.getElementById('notification-icon');
        const closeNotification = document.getElementById('close-notification');

        // 页面初始化
        function init() {
            // 检查是否已登录
            const token = localStorage.getItem('token');
            if (token) {
                localStorage.removeItem('token');
                showLoginCard();
                // window.location.href = '/setting.html';
            } else {
                showLoginCard();
            }

            // 事件监听
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            toRegisterBtn.addEventListener('click', showRegisterCard);
            toLoginBtn.addEventListener('click', showLoginCard);
            loginNavBtn.addEventListener('click', showLoginCard);
            registerNavBtn.addEventListener('click', showRegisterCard);
            logoutNavBtn.addEventListener('click', logout);
            refreshProtectedBtn.addEventListener('click', fetchProtectedContent);
            closeNotification.addEventListener('click', hideNotification);
        }

        // 显示登录卡片
        function showLoginCard() {
            loginCard.classList.remove('hidden');
            registerCard.classList.add('hidden');
            protectedCard.classList.add('hidden');
            loginNavBtn.classList.remove('hidden');
            registerNavBtn.classList.remove('hidden');
            logoutNavBtn.classList.add('hidden');
        }

        // 显示注册卡片
        function showRegisterCard() {
            loginCard.classList.add('hidden');
            registerCard.classList.remove('hidden');
            protectedCard.classList.add('hidden');
            loginNavBtn.classList.remove('hidden');
            registerNavBtn.classList.remove('hidden');
            logoutNavBtn.classList.add('hidden');
        }

        // 显示受保护内容
        function showProtectedContent() {
            loginCard.classList.add('hidden');
            registerCard.classList.add('hidden');
            protectedCard.classList.remove('hidden');
            loginNavBtn.classList.add('hidden');
            registerNavBtn.classList.add('hidden');
            logoutNavBtn.classList.remove('hidden');
            
            fetchProtectedContent();
        }

        // 处理登录
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // localStorage.setItem('token', data.token);
                    localStorage.setItem('token', JSON.stringify(data.token));
                    showNotification('成功', '登录成功，正在进入设置页面', 'success');
                    setTimeout(() => {
                        window.location.href = '/setting.html';
                    }, 1500); 
                } else {
                    showNotification('错误', data.message || '登录失败，请检查用户名和密码', 'error');
                }
            } catch (error) {
                console.error('登录错误:', error);
                showNotification('错误', '网络错误，请稍后重试', 'error');
            }
        }

        // 处理注册
        async function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            // 验证密码一致性
            if (password !== confirmPassword) {
                showNotification('错误', '两次输入的密码不一致', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showNotification('成功', '注册成功，请登录', 'success');
                    showLoginCard();
                } else {
                    showNotification('错误', data.message || '注册失败，请重试', 'error');
                }
            } catch (error) {
                console.error('注册错误:', error);
                showNotification('错误', '网络错误，请稍后重试', 'error');
            }
        }

        // 获取受保护内容
        async function fetchProtectedContent() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                showNotification('错误', '未授权访问', 'error');
                showLoginCard();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/protected`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const contentElement = document.getElementById('protected-content');
                    contentElement.innerHTML = `
                        <div class="space-y-4">
                            <h3 class="font-bold text-lg">用户信息</h3>
                            <p><span class="font-medium">用户名:</span> ${data.user.username}</p>
                            <p><span class="font-medium">用户ID:</span> ${data.user.userId}</p>
                            <p><span class="font-medium">访问时间:</span> ${new Date().toLocaleString()}</p>
                            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <p class="text-blue-700"><i class="fa fa-info-circle mr-2"></i>这是受保护的内容，只有登录用户才能查看。</p>
                            </div>
                        </div>
                    `;
                } else {
                    showNotification('错误', data.message || '获取受保护内容失败', 'error');
                    logout();
                }
            } catch (error) {
                console.error('获取受保护内容错误:', error);
                showNotification('错误', '网络错误，请稍后重试', 'error');
            }
        }

        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            showLoginCard();
            showNotification('成功', '已成功退出登录', 'success');
        }

        // 显示通知
        function showNotification(title, message, type = 'info') {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // 设置图标和颜色
            notificationIcon.className = 'flex-shrink-0 pt-0.5';
            const notificationContent = document.getElementById('notification-content');
            
            if (type === 'success') {
                notificationIcon.innerHTML = '<i class="fa fa-check-circle text-green-500 text-xl"></i>';
                notificationContent.classList.remove('border-blue-500', 'border-red-500');
                notificationContent.classList.add('border-green-500');
            } else if (type === 'error') {
                notificationIcon.innerHTML = '<i class="fa fa-exclamation-circle text-red-500 text-xl"></i>';
                notificationContent.classList.remove('border-blue-500', 'border-green-500');
                notificationContent.classList.add('border-red-500');
            } else {
                notificationIcon.innerHTML = '<i class="fa fa-info-circle text-blue-500 text-xl"></i>';
                notificationContent.classList.remove('border-red-500', 'border-green-500');
                notificationContent.classList.add('border-blue-500');
            }
            
            // 显示通知
            notification.classList.remove('translate-x-full');
            
            // 3秒后自动隐藏
            setTimeout(hideNotification, 3000);
        }

        // 隐藏通知
        function hideNotification() {
            notification.classList.add('translate-x-full');
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    